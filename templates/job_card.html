<div data-view-type="{{ view_type }}" class="job-card
{% if job.description %}red-outline
{% endif %}
{% if job.arrival_datetime and job.arrival_date_in_app_tz == job.date_in_app_tz %}arrival-same-day
{% elif job.arrival_datetime and (job.arrival_date_in_app_tz - job.date_in_app_tz).days == 1 %}arrival-next-day
{% endif %}
{% if job.is_complete %}completed
{% endif %}" id="job-{{ job.id }}" data-job-id="{{ job.id }}">
    <span class="job-close-button small-icon delete-button" data-job-id="{{ job.id }}"
    hx-delete="{{ url_for('job.delete_job', job_id=job.id, view_type=view_type) }}"
    {% if view_type == 'team' %}
    hx-target="#team-columns-container"
    hx-swap="outerHTML"
    {% else %}
    hx-target="#job-list"
    hx-swap="outerHTML"
    {% endif %}
    hx-confirm="Are you sure you want to delete this job? This action cannot be undone."
    style="cursor: pointer">&times;</span>
    
    <div class="job-card-details">
        <div class="job-info">
            <p><strong>Date:</strong> <span id="job-date-{{ job.id }}">{{ job.display_date }}</span></p>
            <p><strong>Time:</strong> <span id="job-start-time-{{ job.id }}">{{ job.display_time }}</span></p>
            <p><strong>Ends:</strong> <span id="job-end-time-{{ job.id }}">{{ job.display_end_time }}</span> (<span id="job-duration-{{ job.id }}">{{ job.duration }}</span>)</p>
            <p><strong>Property Address:</strong> <span id="job-property-address-{{ job.id }}">{{ job.property.address }}</span></p>
        </div>
        <div class="job-status-actions">
            <div class="job-actions" id="job-actions-{{ job.id }}">
                {% if current_user.is_authenticated and current_user.role in ['admin', 'supervisor'] %}
                {% if job.is_complete %}
                <!-- Mark Pending button - immediate action -->
                <button hx-post="{{ url_for('job.mark_job_pending', job_id=job.id) }}?date={{ selected_date }}&view_type={{ view_type }}"
                        hx-target="#job-{{ job.id }}"
                        hx-swap="outerHTML"
                        class="button">
                    <span id="job-update-status-{{ job.id }}">Mark Pending</span>
                </button>
                {% else %}
                <!-- Mark Complete button - triggers report modal -->
                <button hx-post="{{ url_for('job.mark_job_complete', job_id=job.id) }}?date={{ selected_date }}&view_type={{ view_type }}"
                        hx-target="#job-modal-content"
                        hx-swap="innerHTML"
                        hx-on--after-request="document.getElementById('job-modal').style.display='block'"
                        class="button mark-as-complete-button">
                    <span id="job-update-status-{{ job.id }}">Mark Complete</span>
                </button>
                {% endif %}
                {% endif %}
                <button hx-get="{{ url_for('job.get_job_details', job_id=job.id, view_type=view_type) }}"
                        hx-target="#job-modal-content"
                        hx-trigger="click"
                        hx-on--after-request="document.getElementById('job-modal').style.display='block'"
                        class="button">
                    View Details
                </button>
            </div>
            <div class="job-statuses">
                {% if job.arrival_datetime and job.arrival_date == job.date %}
                <div class="job-status-badge red">Same Day Arrival</div>
                {% elif job.arrival_datetime and (job.arrival_date - job.date).days == 1 %}
                <div class="job-status-badge yellow">Next Day Arrival</div>
                {% endif %}
                {% if job.description %}
                <div class="job-status-badge red">See Notes</div>
                {% endif %}
            </div>
        </div>
    </div>
</div>


