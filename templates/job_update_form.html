<form id="edit-job-form"
hx-put="{{ url_for('job.update_job', job_id=job.id) }}"
hx-target="#job-details-modal-content, #job-list"
hx-swap="multi: #job-details-modal-content:innerHTML, #job-list:innerHTML"
hx-include="#edit-job-form"
>
    <h2>Edit Job</h2>
    <div class="job-update-compact">
        <!-- Group 1: Time, Duration & Description (TOP) -->
        <div class="form-group">
            <div class="form-card time-card">
                <div class="card-header">
                    <span class="card-icon">üïê</span>
                    <span class="card-title">Schedule & Arrival</span>
                </div>
                <div class="form-row">
                    <div class="form-field">
                        <label for="time">Start Time</label>
                        <input type="time" id="time" name="time" value="{{ job.time.strftime('%H:%M') }}" required pattern="^([01]\d|2[0-3]):[0-5]\d$" title="Please enter start time in 24-hour format (HH:mm)">
                    </div>
                    <div class="form-field">
                        <label for="end_time">End Time</label>
                        <input type="time" id="end_time" name="end_time" value="{{ job.end_time.strftime('%H:%M') }}" required pattern="^([01]\d|2[0-3]):[0-5]\d$" title="Please enter end time in 24-hour format (HH:mm)">
                    </div>
                    <div class="form-field">
                        <label for="arrival_datetime">Tenant Arrival Date & Time</label>
                        <input type="datetime" id="arrival_datetime" name="arrival_datetime" value="{{ job.arrival_datetime.strftime('%d-%m-%Y %H:%M') if job.arrival_datetime else '' }}" class="flatpickr" data-date-format="{{ datetime_format_flatpickr }}" data-enable-time="true" data-no-calendar="false" placeholder="Select Date and Time">
                    </div>
                </div>
            </div>
            <div class="form-card description-card">
                <div class="card-header">
                    <span class="card-icon">üìù</span>
                    <span class="card-title">Description</span>
                </div>
                <div class="form-field">
                    <textarea id="description" name="notes" rows="3" placeholder="Job description">{{ job.description }}</textarea>
                </div>
            </div>
        </div>
    
        <!-- Group 2: Property, Client & Access Details -->
        <div class="form-group">
            <div class="form-card address-card">
                <div class="card-header">
                    <span class="card-icon">üìç</span>
                    <span class="card-title">Property</span>
                </div>
                <div class="form-field">
                    <select id="property_id" name="property_id" required>
                        {% for property in properties %}
                            <option value="{{ property.id }}" {% if job.property.id == property.id %}selected{% endif %}>{{ property.address }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="form-card client-card">
                <div class="card-header">
                    <span class="card-icon">üë§</span>
                    <span class="card-title">Client</span>
                </div>
                <div class="form-field">
                    <input type="text" value="{{ job.property.client_name or 'Unknown Client' }}" readonly>
                </div>
                <div class="form-field">
                    <input type="text" value="{{ job.property.client_phone or 'No phone' }}" readonly>
                </div>
            </div>
            {% if job.property.access_notes %}
            <div class="form-card access-card">
                <div class="card-header">
                    <span class="card-icon">üîë</span>
                    <span class="card-title">Access</span>
                </div>
                <div class="form-field">
                    <textarea rows="2" readonly>{{ job.property.access_notes }}</textarea>
                </div>
            </div>
            {% endif %}
        </div>
    
        <!-- Group 3: Teams & Cleaners -->
        <div class="form-group">
            <div class="form-card teams-card">
                <div class="card-header">
                    <span class="card-icon">üë•</span>
                    <span class="card-title">Teams</span>
                </div>
                <div class="form-field">
                    <select id="assigned_teams" name="assigned_teams" multiple>
                        {% for team in teams %}
                            <option value="{{ team.id }}" {% if team in job_teams %}selected{% endif %}>{{ team.name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="form-card cleaners-card">
                <div class="card-header">
                    <span class="card-icon">üßπ</span>
                    <span class="card-title">Cleaners</span>
                </div>
                <div class="form-field">
                    <select id="assigned_cleaners" name="assigned_cleaners" multiple>
                        {% for user in users %}
                            <option value="{{ user.id }}" {% if user in job_cleaners %}selected{% endif %}>{{ user.username }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>
    
        <div class="form-actions">
            <button type="submit" class="button save-button">
                üíæ Save Changes
            </button>
        </div>
    </div>
</form>
