<form id="create-team-form" class="form-card" hx-post="/teams/create"
      hx-target=".teams-grid"
      hx-swap="innerHTML"
      hx-on--after-request="if(event.detail.successful) { document.getElementById('team-modal').style.display='none'; document.getElementById('create-team-form').reset(); document.body.dispatchEvent(new Event('teamListUpdated')); } else { document.getElementById('errors-container').innerHTML = event.detail.xhr.response; }">

    <h2>Create New Team</h2>
    <div id="errors-container"></div>

    <div class="form-group">
        <label for="create-team-name">Team Name:</label>
        <input type="text" id="create-team-name" name="team_name" value="">
    </div>

    <div class="form-group">
        <label for="create-team-members">Add Members:</label>
        <select id="create-team-members" name="members" multiple>
            {% if categorized_users.unassigned %}
            <optgroup label="Unassigned">
                {% for user in categorized_users.unassigned %}
                <option value="{{ user.id }}">{{ user.username }}</option>
                {% endfor %}
            </optgroup>
            {% endif %}
            {% if categorized_users.on_a_different_team %}
            <optgroup label="On a Different Team">
                {% for user in categorized_users.on_a_different_team %}
                <option value="{{ user.id }}">{{ user.username }}</option>
                {% endfor %}
            </optgroup>
            {% endif %}
        </select>
    </div>

    <div class="form-group">
        <label for="create-team-leader">Select Team Leader:</label>
        <select id="create-team-leader" name="team_leader_id">
            <option value="">No Leader</option> {# Keep this for explicit "no leader" option #}
            {% if categorized_users.unassigned %}
            <optgroup label="Unassigned">
                {% for user in categorized_users.unassigned %}
                <option value="{{ user.id }}">{{ user.username }}</option>
                {% endfor %}
            </optgroup>
            {% endif %}
            {% if categorized_users.on_a_different_team %}
            <optgroup label="On a Different Team">
                {% for user in categorized_users.on_a_different_team %}
                <option value="{{ user.id }}">{{ user.username }}</option>
                {% endfor %}
            </optgroup>
            {% endif %}
        </select>
    </div>

    <button type="submit" class="button">Create Team</button>
</form>