{% extends "base.html" %}

{% block title %}Teams Management{% endblock %}

{% block content %}
    <div class="container">
        <div class="header-with-button">
            <h1>Teams Management</h1>
        </div>

        <div class="teams-container">
            {% if teams %}
                <div class="teams-grid" id="teams-list-container">
                    {% include 'team_list.html' %}
                </div>
                </div>
            {% else %}
                <div class="no-teams-message">
                    <p>No teams found. Create your first team to get started.</p>
                </div>
            {% endif %}
        </div>
    </div>
    <div id="team-modal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close-button" onclick="document.getElementById('team-modal').style.display='none'">&times;</span>
            <div id="team-modal-content">
                <!-- Team edit form will be loaded here via JavaScript/HTMX -->
            </div>
        </div>
    </div>
    <script src="{{ url_for('static', filename='js/team_management.js') }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Initialise Dragula when the DOM is loaded
            initDragula();
            
            // Listen for HTMX content swaps on the teams grid and reinitialize Dragula
            document.body.addEventListener('htmx:afterSwap', function(event) {
                if (event.detail.target.classList.contains('teams-grid') ||
                    event.detail.target.id === 'teams-list-container') {
                    // Small delay to ensure DOM is fully updated
                    setTimeout(initDragula, 50);
                }
            });
        });
    </script>
{% endblock %}