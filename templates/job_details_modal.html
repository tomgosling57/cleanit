<h2>Job Details</h2>
<div class="job-details-compact">
    <!-- Group 1: Property, Tenant & Access Details -->
    <div class="group-card property-group-card">
        <div class="group-content">
            <div class="group-item">
                <span class="item-icon"><img src="{{ url_for('static', filename='icons/location-pin.svg') }}" alt="Location Pin" class="icon"></span>
                <div class="item-content">
                    <div class="primary-info"><span id="property_address" data-property-id="{{ job.property.id }}">{{ job.property.address }}</span></div>
                </div>
            </div>
            <div class="group-item">
                <span class="item-icon"><img src="{{ url_for('static', filename='icons/user.png') }}" alt="User Profile" class="icon user-icon"></span>
                <div class="item-content">
                    {% if job.arrival_date %}
                    <div class="primary-info">Arrives: <span id="arrival_date">{{ job.display_arrival_date }}</span></div>
                    {% else %}
                    <div class="primary-info">Arrives: Not specified</div>
                    {% endif %}
                    {% if job.arrival_time_only %}
                    <div class="secondary-info">Time: <span id="arrival_time">{{ job.display_arrival_time }}</span></div>
                    {% else %}
                    <div class="secondary-info">Time: Not specified</div>
                    {% endif %}
                </div>
            </div>
            {% if job.property.access_notes %}
            <div class="group-item">
                <span class="item-icon"><img src="{{ url_for('static', filename='icons/key.svg') }}" alt="Access Key" class="icon"></span>
                <div class="item-content">
                    <div id="access-notes" class="primary-info"><span id="access_notes">{{ job.property.access_notes }}</span></div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Group 2: Time, Duration & Description -->
    <div class="group-card schedule-group-card">
        <div class="group-content">
            <div class="group-item">
                <span class="item-icon"><img src="{{ url_for('static', filename='icons/clock.svg') }}" alt="Time" class="icon"></span>
                <div class="item-content">
                    <div class="primary-info">Date: <span id="date">{{ job.display_date }}</span></div>
                    <div class="primary-info">Start: <span id="time">{{ job.display_time }}</span></div>
                    <div class="secondary-info">End: <span id="end_time">{{ job.display_end_time }}</span> ({{ job.duration }})</div>
                </div>
            </div>
            {% if job.arrival_datetime %}
            {% endif %}
            <div class="group-item">
                <span class="item-icon"><img src="{{ url_for('static', filename='icons/notes.svg') }}" alt="Description" class="icon"></span>
                <div class="item-content">
                    <div class="primary-info"><span id="description">{{ job.description }}</span></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Group 3: Teams & Cleaners -->
    <div class="group-card assignment-group-card">
        <div class="group-content">
            <div class="group-item">
                <span class="item-icon"><img src="{{ url_for('static', filename='icons/team.svg') }}" alt="Teams" class="icon"></span>
                <div class="item-content">
                    <div class="primary-info" id="assigned_teams">
                        {% if job_teams %}
                        {% if job_teams|length > 0 %}
                            {% for team in job_teams %}
                                <span class="assignment-tag">{{ team.name }}</span>
                            {% endfor %}
                        {% else %}
                            <span class="no-assignment">No teams assigned</span>
                        {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="group-item">
                <span class="item-icon"><img src="{{ url_for('static', filename='icons/broom.svg') }}" alt="Cleaners" class="icon"></span>
                <div class="item-content">
                    <div class="primary-info" id="assigned_cleaners">
                        {% if job_cleaners %}
                        {% if job_cleaners|length > 0 %}
                            {% for cleaner in job_cleaners %}
                                <span class="assignment-tag">{{ cleaner.first_name }} {{ cleaner.last_name }}</span>
                            {% endfor %}
                        {% else %}
                            <span class="no-assignment">No cleaners assigned</span>
                        {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Status & Actions -->
    <div class="status-actions">
        <div class="job-statuses">
            {% include 'job_status_fragment.html' %}
            {% if job.arrival_datetime and job.arrival_datetime.date() == job.date %}
            <div class="job-status-badge red">Same Day Arrival</div>
            {% elif job.arrival_datetime and (job.arrival_datetime.date() - job.date).days == 1 %}
            <div class="job-status-badge yellow">Next Day Arrival</div>
            {% endif %}
            {% if job.description %}
            <div class="job-status-badge red">See Notes</div>
            {% endif %}
            {% if job.report and job.is_complete %}
            <div class="job-status-badge green">Report Submitted</div>
            {% endif %}
        </div>
        <!-- Job actions buttons container added by llm -->
        <div class="job-action-buttons">
            {% if current_user.role == 'admin' %}
                <button hx-get="{{ url_for('job.update_job', job_id=job.id, view_type=view_type) }}"
                    hx-target="#job-modal-content"
                    hx-swap="innerHTML"
                    hx-trigger="click"
                class="button edit-button">
                    <span class="icon">{{ svg_icons['pencil-solid-full'] | safe }}</span>Edit
                </button>
            {% endif %}
            <!-- Property Reference Gallery Button -->
            <button onclick="ENHANCED_GALLERY.open({type: 'property', id: '{{ job.property.id }}'})"
                class="button gallery-button property-gallery-button">
                 <span class="icon">{{ svg_icons['gallery'] | safe }}</span>Property Gallery
            </button>
            <!-- Job Report Gallery Button (only shown when job is complete with report) -->
            {% if job.is_complete and job.report %}
            <button onclick="ENHANCED_GALLERY.open({type: 'job', id: '{{ job.id }}'})"
                class="button gallery-button job-report-gallery-button">
                 <span class="icon">{{ svg_icons['clipboard'] | safe }}</span>Job Report Gallery
            </button>
            {% endif %}
        </div>
    </div>
</div>
