{% extends "base.html" %}

{% block title %}Timetable{% endblock %}

{% block content %}
    <div class="container">
        <h1>Welcome, {{ user.name }} ({{ user.role }})!</h1>
        <p>Today: {{ today }}</p>

        {% if user.role == "Cleaner" %}
            <h2>Your Bookings</h2>
            {% if bookings %}
                <div class="timetable">
                    {% for booking in bookings %}
                        <div class="job-card">
                            <h3>{{ booking.job_title }}</h3>
                            <p><strong>Date:</strong> {{ booking.date }}</p>
                            <p><strong>Time:</strong> {{ booking.time }}</p>
                            <p><strong>Duration:</strong> {{ booking.duration }}</p>
                            <p><strong>Assigned Cleaners:</strong>
                                {% for cleaner_id in booking.assigned_cleaners %}
                                    {{ users[cleaner_id].name }}{% if not loop.last %}, {% endif %}
                                {% endfor %}
                            </p>
                            <p><strong>Description:</strong> {{ booking.description }}</p>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p>No bookings found for you today.</p>
            {% endif %}
        {% elif user.role == "Team Leader" %}
            <h2>All Team Bookings</h2>
            <div class="team-timetable">
                {% for team_id, team_bookings_list in team_bookings.items() %}
                    <div class="team-column">
                        <h3>{{ teams[team_id].name }}</h3>
                        {% if team_bookings_list %}
                            {% for booking in team_bookings_list %}
                                <div class="job-card">
                                    <h3>{{ booking.job_title }}</h3>
                                    <p><strong>Date:</strong> {{ booking.date }}</p>
                                    <p><strong>Time:</strong> {{ booking.time }}</p>
                                    <p><strong>Duration:</strong> {{ booking.duration }}</p>
                                    <p><strong>Assigned Cleaners:</strong>
                                        {% for cleaner_id in booking.assigned_cleaners %}
                                            {{ users[cleaner_id].name }}{% if not loop.last %}, {% endif %}
                                        {% endfor %}
                                    </p>
                                    <p><strong>Description:</strong> {{ booking.description }}</p>
                                    <p><strong>Report:</strong> {{ booking.report if booking.report else "No report yet." }}</p>
                                    <a href="{{ url_for('job_detail', job_id=booking.id) }}" class="button">View/Edit Report</a>
                                </div>
                            {% endfor %}
                        {% else %}
                            <p>No bookings for this team today.</p>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
        <p><a href="{{ url_for('logout') }}" class="button">Logout</a></p>
    </div>
{% endblock %}